---
- name: Import vars file
  include_vars: "../vars/main.yml"
  tags:
    - nvim
    - tunning
    - development

- name: Create paths needed for VIM
  file:
    path: "/Users/{{ lookup('env', 'USER') }}/.config/{{ item }}/"
    state: directory
    owner: "{{ lookup('env', 'USER') }}"
    group: "{{ global.group }}"
  with_items:
    - nvim
    - nvim/lua/
    - nvim/plugin/
    - nvim/ftdetect/
  tags:
    - nvim
    - tunning
    - development

- name: Download Plug Installer
  shell: |
     sh -c 'curl -fLo "${XDG_DATA_HOME:-$HOME/.local/share}"/nvim/site/autoload/plug.vim --create-dirs https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim'
  tags:
    - nvim
    - tunning
    - development

- name: Download Packer Installer
  shell: |
    if [[ ! -d ~/.local/share/nvim/site/pack/packer/start/packer.nvim ]]; then
      git clone --depth 1 https://github.com/wbthomason/packer.nvim\
      ~/.local/share/nvim/site/pack/packer/start/packer.nvim
    fi
  tags:
    - nvim
    - tunning
    - development

- name: Copy all config files
  copy:
    src: ../files/nvim_lua
    dest: "/Users/{{ lookup('env', 'USER') }}/.config/"
    owner: "{{ lookup('env', 'USER') }}"
    group: "{{ global.group }}"
    mode: '0644'
  tags:
    - nvim 
    - tunning
    - development

  #- name: Load Packer Config
  #  shell: |
  #    nvim --headless -c 'autocmd User PackerComplete quitall' -c 'PackerSync'
  #  tags:
  #    - nvim
  #    - tunning
  #    - development

- name: "Setup NVIM for user: {{ lookup('env', 'USER') }}"
  copy:
    src: ../files/nvim/init.vim
    dest: "/Users/{{ lookup('env', 'USER') }}/.config/nvim/"
    owner: "{{ lookup('env', 'USER') }}"
    group: "{{ global.group }}"
    mode: '0644'
  tags:
    - nvim 
    - tunning
    - development
    
- name: "Copy NVIM go files" 
  copy:
    src: ../files/nvim/ftdetect/go.vim
    dest: "/Users/{{ lookup('env', 'USER') }}/.config/nvim/ftdetect/"
    owner: "{{ lookup('env', 'USER') }}"
    group: "{{ global.group }}"
    mode: '0644'
  tags:
    - nvim 
    - tunning
    - development

- name: "Copy NVIM plugin files" 
  copy:
    src: ../files/nvim/plugin/telescope.nvim
    dest: "/Users/{{ lookup('env', 'USER') }}/.config/nvim/plugin/"
    owner: "{{ lookup('env', 'USER') }}"
    group: "{{ global.group }}"
    mode: '0644'
  tags:
    - nvim 
    - tunning
    - development

- name: Install plugins VIM
  command: vim +'PlugInstall --sync' +qa
  tags:
    - nvim
    - tunning
    - development
